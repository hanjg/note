[toc]
## redis简介 ##
- [redis数据结构](https://blog.csdn.net/qq_40369829/article/details/113761356)

## redis内存空间 ##
### 对象内存 ###
#### 键空间 ####
- dict字典保存数据库所有键值对。
- 键：字符串对象。
- 值：5中对象中的一种。	

#### 过期字典 ####
- expires字典保存所有键的过期时间。
- 键：数据的键。
- 值：毫秒级Unix时间戳。

### 缓冲内存 ###
- 客户端缓冲。
- 复制积压缓冲。主从复制。
- AOF缓冲。持久化。

### 内存碎片 ###
- 默认jemalloc分配器。
- 比如大量过期键删除导致释放的空间无法有效利用。

### 自身内存 ###
- 子进程消耗。如AOF、RDB持久化fork的子进程。

## key过期策略 ##
- 3种策略。

### 惰性删除 ###
- 执行命令时如果该key设置了过期时间，检查过期，如果过期则删除，返回空。
### 定期删除 ###
- 默认每隔100ms从expires字典中**随机取**key，检查过期，如果过期则删除。

### 内存淘汰 ###
- 内存不足以容纳新写入的数据时，删除某些数据。
  - 6种算法，常用算法 **allkeys-lru** ,移除键空间中最近最少使用key。