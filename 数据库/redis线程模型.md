[toc]
## 文件事件线程模型 ##
- ![191112.redisthread.png](https://img-blog.csdnimg.cn/20191112093321260.png)
- 事件驱动设计，采用[reactor模式](https://www.cnblogs.com/doit8791/p/7461479.html)——每当一个Event输入到Service Handler之后，该Service Handler会主动的根据不同的Event类型将其分发给对应的Request Handler来处理。

### 套接字 ###
- 每个套接字准备好执行连接应答、写入、读取、关闭等操作时，都会产生一个文件事件。
- 一个服务通常会连接多个套接字。
- 文件事件：对套接字操作的抽象。
  - 套接字可读（客户端write,close）、新的可应答套接字（客户端connect），套接字产生AE_READABLE事件。
  - 套接字可写（客户端read），套接字产生AE_WRITABLE事件。
  - 同一个套接字**优先处理AE_READABLE**事件。

### I/O多路复用程序 ###
- 监听多个套接字，并通过**队列**传递产生了事件的套接字给下游事件分派器。

### 文件事件分派器 ###
- 接收队列中的套接字，并根据**事件类型**调用相应的事件处理器。
- 上一个套接字关联的事件处理器执行完毕，才继续处理下一个套接字。
- redis**单线程**指的是[事件分派器单线程](https://blog.csdn.net/dreamwbt/article/details/81148588)，建立连接时多线程的。

### 事件处理器 ###
- 是一个个函数，处理对应事件。 	常用的有：
  - 连接应答处理器：redis服务器初始化时，关联**服务器监听套接字**产生的AE_READABLE事件。事件在客户端connect时产生，创建套接字。
  - 命令请求处理器：客户端连接成功后，关联**客户端套接字**的AE_READABLE事件。该事件在客户端发送请求时产生。
  - 命令回复处理器：服务器有命令回复需要传送给客户端时，关联**客户端套接字**的AE_WRITABLE事件。事件在客户端尝试读取时产生。

## 时间事件模型 ##
- 分为定期事件和周期事件。
- 文件事件和时间事件之间是合作关系，服务器**轮流处理**，不会抢占，所以时间事件实际处理事件通常比设定的晚一点。

## 高效的单线程 ##
原因：
- 纯内存操作。
- 非阻塞I/O多路复用。
- C语言，效率高。
- 单线程没有线程切换开销。